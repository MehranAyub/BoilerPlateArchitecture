<div [@routerTransition]>
    <div class="kt-subheader kt-grid__item">
        <div class="kt-subheader__main">
            <h3 class="kt-subheader__title">
                <span>{{ l("Properties") }}</span>
            </h3>
            <span
                class="kt-subheader__separator kt-subheader__separator--v"
            ></span>
            <span class="kt-subheader__desc"> Properties List </span>
        </div>
        <div class="kt-subheader__toolbar">
            <div class="kt-subheader__wrapper">
                <button
                    id="btn_create_property"
                    *ngIf="isGranted('Pages.Properties.Create')"
                    (click)="createProperty()"
                    class="btn btn-primary blue"
                >
                    <i class="fa fa-plus"></i> {{ l("CreateNewProperty") }}
                </button>
            </div>
        </div>
    </div>

    <div class="kt-content" style="padding-bottom: 75px;">
        <div class="kt-portlet kt-portlet--mobile">
            <div class="kt-portlet__body">
                <form class="kt-form" autocomplete="off">
                    <div>
                        <div class="row align-items-center">
                            <div class="col-xl-12">
                                <div
                                    class="form-group m-form__group align-items-center"
                                >
                                    <div class="input-group">
                                        <input
                                            [(ngModel)]="filterText"
                                            name="filterText"
                                            autoFocus
                                            class="form-control m-input"
                                            [placeholder]="
                                                l('SearchWithThreeDot')
                                            "
                                            type="text"
                                        />
                                        <span class="input-group-btn">
                                            <button
                                                (click)="getProperties()"
                                                class="btn btn-primary"
                                                type="submit"
                                            >
                                                <i
                                                    class="flaticon-search-1"
                                                ></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" [hidden]="!advancedFiltersAreShown">
                            <div class="col-md-12">
                                <div
                                    class="kt-separator kt-separator--border-dashed"
                                ></div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="AddressFilter">{{
                                        l("Address")
                                    }}</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="AddressFilter"
                                        name="addressFilter"
                                        [(ngModel)]="addressFilter"
                                    />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="PropertySpecsFilter">{{
                                        l("PropertySpecs")
                                    }}</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="PropertySpecsFilter"
                                        name="propertySpecsFilter"
                                        [(ngModel)]="propertySpecsFilter"
                                    />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="DescriptionFilter">{{
                                        l("Description")
                                    }}</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="DescriptionFilter"
                                        name="descriptionFilter"
                                        [(ngModel)]="descriptionFilter"
                                    />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="MinWholeSalePriceFilter"
                                        >{{ l("MinMax") }}
                                        {{ l("WholeSalePrice") }}</label
                                    >
                                    <div class="input-group">
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="MinWholeSalePriceFilter"
                                            [(ngModel)]="
                                                minWholeSalePriceFilter
                                            "
                                            placeholder="{{ l('MinValue') }}"
                                            name="minWholeSalePriceFilter"
                                        />
                                        <input
                                            type="number"
                                            class="form-control"
                                            [(ngModel)]="
                                                maxWholeSalePriceFilter
                                            "
                                            placeholder="{{ l('MaxValue') }}"
                                            name="maxWholeSalePriceFilter"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="MinEstimatedARVFilter"
                                        >{{ l("MinMax") }}
                                        {{ l("EstimatedARV") }}</label
                                    >
                                    <div class="input-group">
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="MinEstimatedARVFilter"
                                            [(ngModel)]="minEstimatedARVFilter"
                                            placeholder="{{ l('MinValue') }}"
                                            name="minEstimatedARVFilter"
                                        />
                                        <input
                                            type="number"
                                            class="form-control"
                                            [(ngModel)]="maxEstimatedARVFilter"
                                            placeholder="{{ l('MaxValue') }}"
                                            name="maxEstimatedARVFilter"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="MinEstimatedRehabFilter"
                                        >{{ l("MinMax") }}
                                        {{ l("EstimatedRehab") }}</label
                                    >
                                    <div class="input-group">
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="MinEstimatedRehabFilter"
                                            [(ngModel)]="
                                                minEstimatedRehabFilter
                                            "
                                            placeholder="{{ l('MinValue') }}"
                                            name="minEstimatedRehabFilter"
                                        />
                                        <input
                                            type="number"
                                            class="form-control"
                                            [(ngModel)]="
                                                maxEstimatedRehabFilter
                                            "
                                            placeholder="{{ l('MaxValue') }}"
                                            name="maxEstimatedRehabFilter"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="ViewingDescriptionFilter">{{
                                        l("ViewingDescription")
                                    }}</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="ViewingDescriptionFilter"
                                        name="viewingDescriptionFilter"
                                        [(ngModel)]="viewingDescriptionFilter"
                                    />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="MinEMDRequirementFilter"
                                        >{{ l("MinMax") }}
                                        {{ l("EMDRequirement") }}</label
                                    >
                                    <div class="input-group">
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="MinEMDRequirementFilter"
                                            [(ngModel)]="
                                                minEMDRequirementFilter
                                            "
                                            placeholder="{{ l('MinValue') }}"
                                            name="minEMDRequirementFilter"
                                        />
                                        <input
                                            type="number"
                                            class="form-control"
                                            [(ngModel)]="
                                                maxEMDRequirementFilter
                                            "
                                            placeholder="{{ l('MaxValue') }}"
                                            name="maxEMDRequirementFilter"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="ViewingContactFilter">{{
                                        l("ViewingContact")
                                    }}</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="ViewingContactFilter"
                                        name="viewingContactFilter"
                                        [(ngModel)]="viewingContactFilter"
                                    />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="OfferContactFilter">{{
                                        l("OfferContact")
                                    }}</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="OfferContactFilter"
                                        name="offerContactFilter"
                                        [(ngModel)]="offerContactFilter"
                                    />
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="IsFeatured"> Is Featured</label>
                                    <input
                                        type="checkbox"
                                        id="IsFeatured"
                                        name="IsFeatured"
                                        [(ngModel)]="IsFeatured"
                                        class="ml-3"
                                    />
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="IsForRent">
                                        <input
                                            type="radio"
                                            id="IsForRent"
                                            name="propertyStatus"
                                            [(ngModel)]="PropertyStatusFilter"
                                            name="propertyStatus"
                                            [value]="PropertyStatus.IsForRent"
                                        />
                                        <span class="ml-3">For Rent</span>
                                    </label>

                                    <label class="ml-3" for="IsForSale">
                                        <input
                                            type="radio"
                                            id="IsForSale"
                                            name="propertyStatus"
                                            [(ngModel)]="PropertyStatusFilter"
                                            name="propertyStatus"
                                            [value]="PropertyStatus.IsForSale"
                                        />
                                        <span class="ml-3">For Sale</span>
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-12 mt-5">
                                <button
                                    (click)="resetFilters()"
                                    class="btn btn-secondary btn-sm"
                                    id="btn-reset-filters"
                                >
                                    Reset
                                </button>
                            </div>
                        </div>
                        <div class="row my-4">
                            <div class="col-sm-12">
                                <span
                                    class="clickable-item text-muted"
                                    *ngIf="!advancedFiltersAreShown"
                                    (click)="
                                        advancedFiltersAreShown =
                                            !advancedFiltersAreShown
                                    "
                                    ><i class="fa fa-angle-down"></i>
                                    {{ l("ShowAdvancedFilters") }}</span
                                >
                                <span
                                    class="clickable-item text-muted"
                                    *ngIf="advancedFiltersAreShown"
                                    (click)="
                                        advancedFiltersAreShown =
                                            !advancedFiltersAreShown
                                    "
                                    ><i class="fa fa-angle-up"></i>
                                    {{ l("HideAdvancedFilters") }}</span
                                >
                            </div>
                        </div>
                    </div>
                </form>

                <div class="row align-items-center">
                    <!--<Primeng-Datatable-Start>-->
                    <div
                        class="primeng-datatable-container col-12"
                        [busyIf]="primengTableHelper.isLoading"
                    >
                        <p-table
                            #dataTable
                            (onLazyLoad)="getProperties($event)"
                            [value]="primengTableHelper.records"
                            rows="{{
                                primengTableHelper.defaultRecordsCountPerPage
                            }}"
                            [paginator]="false"
                            [lazy]="true"
                            [scrollable]="true"
                            ScrollWidth="100%"
                            [tableStyle]="{ 'min-width': '50rem' }"
                            [resizableColumns]="
                                primengTableHelper.resizableColumns
                            "
                        >
                            <ng-template pTemplate="header">
                                <tr>
                                    <th
                                        style="width: 130px"
                                        [hidden]="
                                            !isGrantedAny(
                                                'Pages.Properties.Edit',
                                                'Pages.Properties.Delete'
                                            )
                                        "
                                    >
                                        {{ l("Actions") }}
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="address"
                                    >
                                        {{ l("Address") }}
                                        <!-- <p-sortIcon
                                            field="property.address"
                                        ></p-sortIcon> -->
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="propertySpecs"
                                    >
                                        Specs
                                        <!-- <p-sortIcon
                                            field="property.propertySpecs"
                                        ></p-sortIcon> -->
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="description"
                                    >
                                        {{ l("Description") }}
                                        <!-- <p-sortIcon
                                            field="property.description"
                                        ></p-sortIcon> -->
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="wholeSalePrice"
                                    >
                                        Wholesale Price
                                        <p-sortIcon
                                            field="property.wholeSalePrice"
                                        ></p-sortIcon>
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="estimatedARV"
                                    >
                                        Est ARV
                                        <p-sortIcon
                                            field="property.estimatedARV"
                                        ></p-sortIcon>
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="estimatedRehab"
                                    >
                                        Est Rehab
                                        <p-sortIcon
                                            field="property.estimatedRehab"
                                        ></p-sortIcon>
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="viewingDescription"
                                    >
                                        View desc
                                        <p-sortIcon
                                            field="property.viewingDescription"
                                        ></p-sortIcon>
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="emdRequirement"
                                    >
                                        EMD Req
                                        <p-sortIcon
                                            field="property.emdRequirement"
                                        ></p-sortIcon>
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="viewingContact"
                                    >
                                        View Contact
                                        <p-sortIcon
                                            field="property.viewingContact"
                                        ></p-sortIcon>
                                    </th>
                                    <th
                                        style="width: 150px"
                                        pSortableColumn="offerContact"
                                    >
                                        Offer Contact
                                        <p-sortIcon
                                            field="property.offerContact"
                                        ></p-sortIcon>
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template
                                pTemplate="body"
                                let-record="$implicit"
                                let-i="rowIndex"
                            >
                                <tr>
                                    <td
                                        style="width: 130px"
                                        [hidden]="
                                            !isGrantedAny(
                                                'Pages.Properties.Edit',
                                                'Pages.Properties.Delete'
                                            )
                                        "
                                    >
                                        <div
                                            class="btn-group dropdown"
                                            dropdown
                                            container="body"
                                        >
                                            <button
                                                class="dropdown-toggle btn btn-sm btn-primary"
                                                dropdownToggle
                                            >
                                                <i class="fa fa-cog"></i
                                                ><span class="caret"></span>
                                                {{ l("Actions") }}
                                            </button>
                                            <ul
                                                class="dropdown-menu"
                                                *dropdownMenu
                                            >
                                                <li>
                                                    <a
                                                        *ngIf="
                                                            permission.isGranted(
                                                                'Pages.Properties.Edit'
                                                            )
                                                        "
                                                        [routerLink]="[
                                                            '/app/main/entities/properties/view'
                                                        ]"
                                                        [queryParams]="{
                                                            id: record.property
                                                                .id
                                                        }"
                                                    >
                                                        {{ l("View") }}
                                                    </a>
                                                </li>
                                                <li>
                                                    <a
                                                        *ngIf="
                                                            permission.isGranted(
                                                                'Pages.Properties.Edit'
                                                            )
                                                        "
                                                        [routerLink]="[
                                                            '/app/main/entities/properties/createOrEdit'
                                                        ]"
                                                        [queryParams]="{
                                                            id: record.property
                                                                .id
                                                        }"
                                                    >
                                                        {{ l("Edit") }}
                                                    </a>
                                                </li>
                                                <li>
                                                    <a
                                                        href="javascript:;"
                                                        *ngIf="
                                                            permission.isGranted(
                                                                'Pages.Properties.Delete'
                                                            )
                                                        "
                                                        (click)="
                                                            deleteProperty(
                                                                record.property
                                                            )
                                                        "
                                                        >{{ l("Delete") }}</a
                                                    >
                                                </li>
                                                <li>
                                                    <a
                                                        [routerLink]="[
                                                            '/app/main/entities/properties/upload'
                                                        ]"
                                                        [queryParams]="{
                                                            id: record.property
                                                                .id
                                                        }"
                                                    >
                                                        Add Images
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                    <td style="width: 150px">
                                        {{
                                            record.property?.address?.length >
                                            20
                                                ? (record.property.address
                                                      | slice : 0 : 20) + "..."
                                                : record.property?.address
                                        }}
                                    </td>
                                    <td style="width: 150px">
                                        {{
                                            record.property?.propertySpecs
                                                ?.length > 20
                                                ? (record.property.propertySpecs
                                                      | slice : 0 : 20) + "..."
                                                : record.property?.propertySpecs
                                        }}
                                    </td>
                                    <td style="width: 150px">
                                        {{
                                            record.property?.description
                                                ?.length > 20
                                                ? (record.property.description
                                                      | slice : 0 : 20) + "..."
                                                : record.property?.description
                                        }}
                                    </td>
                                    <td style="width: 150px">
                                        {{ record.property.wholeSalePrice }}
                                    </td>
                                    <td style="width: 150px">
                                        {{ record.property.estimatedARV }}
                                    </td>
                                    <td style="width: 150px">
                                        {{ record.property.estimatedRehab }}
                                    </td>
                                    <td style="width: 150px">
                                        {{
                                            record.property?.viewingDescription
                                                ?.length > 20
                                                ? (record.property
                                                      .viewingDescription
                                                  | slice : 0 : 20)
                                                : record.property
                                                      ?.viewingDescription
                                        }}
                                    </td>
                                    <td style="width: 150px">
                                        {{ record.property.emdRequirement }}
                                    </td>
                                    <td style="width: 150px">
                                        {{ record.property.viewingContact }}
                                    </td>
                                    <td style="width: 150px">
                                        {{ record.property.offerContact }}
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div
                            class="primeng-no-data"
                            *ngIf="primengTableHelper.totalRecordsCount == 0"
                        >
                            {{ l("NoData") }}
                        </div>
                        <div class="primeng-paging-container">
                            <p-paginator
                                [rows]="
                                    primengTableHelper.defaultRecordsCountPerPage
                                "
                                #paginator
                                (onPageChange)="getProperties($event)"
                                [totalRecords]="
                                    primengTableHelper.totalRecordsCount
                                "
                                [rowsPerPageOptions]="
                                    primengTableHelper.predefinedRecordsCountPerPage
                                "
                                [showCurrentPageReport]="true"
                                [currentPageReportTemplate]="
                                    'TotalRecordsCount'
                                        | localize
                                            : primengTableHelper.totalRecordsCount
                                "
                            >
                            </p-paginator>
                        </div>
                    </div>
                    <!--<Primeng-Datatable-End>-->
                </div>
            </div>
        </div>
    </div>
</div>
